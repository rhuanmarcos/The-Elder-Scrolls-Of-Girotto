let mapa = [ ['*', "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*"],//0
              ['*', "_", "_", "_", "_", "D", "_", "#", "#", "#", "#", "#", "#", "#", "#", "_", "_", "_", "_", "*", "_", "o", "_", "*", "_", "#", "_", "_", "_", "*"],//1
              ['*', "_", "_", "_", "_", "*", "_", "#", "_", "_", "_", "_", "_", "_", "#", "_", "_", "_", "_", "*", "_", "_", "_", "*", "_", "#", "_", "_", "_", "*"],//2
              ['*', "_", "_", "_", "_", "*", "_", "#", "_", "#", "#", "#", "#", "_", "#", "_", "_", "_", "_", "*", "_", "_", "_", "*", "_", "#", "#", "#", "#", "*"],//3
              ['*', "_", "_", "_", "_", "*", "_", "#", "_", "#", "@", "_", "#", "_", "#", "_", "_", "_", "_", "_", "*", "_", "*", "_", "_", "_", "_", "_", "_", "D"],//4
              ['*', "_", "_", "_", "_", "*", "_", "#", "_", "#", "#", "#", "#", "_", "#", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "#", "#", "#", "#", "*"],//5
              ['*', "_", "_", "_", "_", "*", "_", "#", "_", "_", "_", "_", "#", "_", "#", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "#", "_", "_", "_", "*"],//6
              ['*', "_", "_", "_", "_", "*", "_", "#", "#", "#", "#", "#", "#", "_", "#", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "#", "_", "_", "_", "*"],//7
              ['*', "_", "_", "_", "_", "*", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "#", "_", "_", "_", "*"],//8
              ['*', "_", "_", "_", "_", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*"],//9
              ['*', "#", "_", "#", "#", "*", "_", "_", "_", "*", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "*"],//10
              ['*', "#", "_", "#", "#", "*", "_", "@", "_", "*", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "*"],//11
              ['*', "#", "_", "_", "#", "*", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "*"],//12
              ['*', "#", "#", "_", "#", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "_", "_", "_", "_", "_", "_", "_", "_", "_", "*"],//13
              ['*', "#", "#", "_", "#", "*", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "*", "*", "_", "*", "*"],//14
              ['*', "_", "_", "_", "_", "*", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "*", "_", "_", "_", "*"],//15
              ['*', "_", "_", "_", "_", "*", "*", "*", "*", "*", "*", "*", "*", "*", "_", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "_", "_", "_", "*"],//16
              ['*', "_", "_", "_", "_", "*", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "*", "_", "_", "_", "*"],//17
              ['*', "#", "#", "_", "#", "*", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "*", "_", "_", "_", "*"],//18
              ['*', "_", "_", "_", "_", "*", "*", "*", "*", "*", "*", "*", "*", "_", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "_", "_", "_", "*"],//19
              ['*', "_", "_", "_", "_", "*", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "*", "_", "_", "_", "*"],//20
              ['*', "#", "_", "#", "#", "*", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "*", "_", "_", "_", "*"],//21
              ['*', "_", "_", "_", "_", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "_", "*", "*", "*", "_", "_", "_", "*"],//22
              ['*', "_", "_", "_", "_", "*", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "*", "_", "_", "_", "*"],//23
              ['*', "#", "#", "_", "#", "*", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "*", "_", "_", "_", "*"],//24
              ['*', "_", "_", "_", "_", "*", "_", "_", "_", "_", "_", "_", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "_", "_", "_", "*"],//25
              ['*', "_", "_", "_", "_", "*", "*", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "*", "_", "_", "_", "*"],//26
              ['*', "_", "_", "_", "_", "_", "D", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "*", "_", "_", "_", "*"],//27
              ['*', "_", "_", "_", "_", "*", "*", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "_", "*", "_", "_", "_", "*"],//28
              ['*', "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*"]];//29
              //0    1    2    3    4    5    6    7    8    9    10   11   12   13   14  15   16   17   18   19   20   21   22   23    24   25   26   27   28   29    
    

 let x = 27;
 let y = 27;
/*y = linha e x= coluna*/
let chave1 = true;
let chave2 = true;
let chave3 = true;
let botao1 = true;
let imune = false;
let mapaInicial = mapa
const estadoInicial=[mapa,chave1,chave2,chave3,botao1]
let vidas = 3;
function desenharMapa() {
  let texto = "";
  document.getElementById('vidas').textContent = `Vidas: ${vidas}`;
  if (!chave1) {
    mapa[27][6]='='
  }else {
    mapa[11][7]='@'
    mapa[27][6]='D'
  }if (!chave2) {
    mapa[1][5]='='
  }else{
    mapa[27][23]='@'
    mapa[1][5]='D'
  }if (!chave3) {
    mapa[4][29]='='
  }else{
    mapa[4][10]='@'
    mapa[4][29]='D'
  }if (!botao1) {
    mapa[1][21]='o'
    mapa[5][11]='_'
    setTimeout(() => {
      botao1=estadoInicial[4];
      mapa[1][21]='o'
      mapa[5][11]='#'}, 12000); 
  }else{
    mapa[1][21]='o'
    mapa[5][11]='#'

  }
 
  mapa[y][x] = '&';
  for (let i = 0; i < 30; i++) {
    for (let j = 0; j < 30; j++) {
      if (mapa[i][j] === '_') {
        texto += `<span style="color: transparent">_ </span>`;
      }else if (mapa[i][j] === '*') {
        texto += `<span style="color: aqua">* </span>`;
      }else if (mapa[i][j] === '@') {
        texto += `<span style="color: yellow">@ </span>`;
      }else if (mapa[i][j] === 'D') {
        texto += `<span style="color: brown">D </span>`;
      }else if (mapa[i][j] === 'o') {
        texto += `<span style="color: gray">o </span>`;
      }else if (mapa[i][j] === '#') {
        texto += `<span style="color: green"># </span>`;
      }
      else {
        texto += `${mapa[i][j]} `;
      }
    }
    texto += `\n`;
  }
  
  
  document.getElementById('mapa2').innerHTML = texto;
  }
  
function vida(params) {
  
  if (!imune && vidas > 0 ) {
    alert('você perdeu uma vida')
        mapa = estadoInicial[0];
        chave1=estadoInicial[1];
        chave2=estadoInicial[2];
        chave3=estadoInicial[3];
        botao1=estadoInicial[4];
        x=27
        y=27
        vidas -=1
        document.getElementById('vidas').textContent = `Vidas: ${vidas}`;
  }
  if (vidas == 0) {
    window.open("../html/derrota.html", "_self");
  } 
}
desenharMapa();
document.addEventListener('keydown', (evento) => {
  
 //console.log(y)
  //console.log(x)

  mapa[y][x] = '_';
 
switch (evento.key) {
  case 'w':
    if ( mapa[y-1][x] !== '*' && mapa[y-1][x] !== 'D' ) {
      if (mapa[y-1][x]==="#") {
         vida()
      }else {
         y -= 1;
      }
  }  
      break;
  case 's':
    if ( mapa[y+1][x] !== '*' && mapa[y+1][x] !== 'D' ) {
      if (mapa[y+1][x]==="#") {
         vida()
      }else {
         y += 1;
      }
  }  
    break;
  case 'a':
    if ( mapa[y][x-1] !== '*' && mapa[y][x-1] !== 'D' ) {
      if (mapa[y][x-1]==="#") {
         vida()
      }else {
         x-= 1;
      }
  } break;
  case 'd':
    if ( mapa[y][x+1] !== '*' && mapa[y][x+1] !== 'D' ) {
      if (mapa[y][x+1]==="#") {
         vida()
      }else {
         x += 1;
      }
  } break;
  case 'ç':
   imune = !imune   
      console.log('Modo imune '+imune);
     break;
  case 'i': 
    if (y==11 && x==7) {
      chave1 = false
    }else if (y==27 && x==23) {
      chave2 = false
    }else if (y==4 &&x==10) {
      chave3 = false
    }
    else if (y==1 && x==21) {
      botao1 = false
    }
    break;
}
desenharMapa();

if (y == 4 && x == 29) {
  mapa[4][29] = '=';
  desenharMapa();

  alert('Você concluiu a segunda fase!')
  window.location.href = '../html/fase3.html';
}
});
function voltar() {
  window.open("../html/menu.html", "_self");
}